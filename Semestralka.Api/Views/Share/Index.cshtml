@model Semestralka.Models.Calendar

@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

@{
    if (Model == null)
    {
        <p>Kalendář není dostupný.</p>
        return;
    }

    var currentUserId = HttpContextAccessor.HttpContext?.Session.GetString("userid");
    bool isOwner = currentUserId != null && Model.OwnerId.ToString() == currentUserId;

    string calendarDisplayName = isOwner
        ? "Můj kalendář"
        : $"Kalendář vlastníka – {Model.Owner?.FullName}";
}

<h2 class="mb-4">@calendarDisplayName – Sdílení</h2>

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}

<form method="post" class="mb-4">
    <div class="mb-3">
        <label>Email uživatele:</label>
        <input type="email" name="email" required class="form-control" />
    </div>

    <div class="mb-3">
        <label>Práva:</label>
        <select name="permission" class="form-control">
            <option value="read">Pouze číst</option>
            <option value="edit">Upravit události</option>
        </select>
    </div>

    <button class="btn btn-primary">Sdílet kalendář</button>
</form>

<h4>Kalendář je sdílen s:</h4>

@if (Model.SharedWith == null || !Model.SharedWith.Any())
{
    <p class="text-muted">Kalendář není sdílen s nikým.</p>
}
else
{
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Jméno</th>
                <th>Email</th>
                <th>Práva</th>
                <th></th>
            </tr>
        </thead>

        <tbody>
        @foreach (var share in Model.SharedWith)
        {
            <tr>
                <td>@share.User?.FullName</td>
                <td>@share.User?.Email</td>
                <td>@share.Permission</td>
                <td>
                    <a href="/calendar/share/remove/@share.Id" class="btn btn-sm btn-danger">
                        Odebrat
                    </a>
                </td>
            </tr>
        }
        </tbody>
    </table>
}
