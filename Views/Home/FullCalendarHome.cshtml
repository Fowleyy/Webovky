@model Semestralka.Models.Calendar

@{
    ViewData["Title"] = "Kalendář";
}

<!-- HEADER -->
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="fw-bold">Kalendář</h2>

    <div class="d-flex gap-2">
        <button id="cal-day" class="btn btn-outline-purple">Den</button>
        <button id="cal-week" class="btn btn-outline-purple">Týden</button>
        <button id="cal-month" class="btn btn-purple">Měsíc</button>
    </div>
</div>

<!-- FULLCALENDAR -->
<div id="calendar" class="mb-4"></div>

<!-- FullCalendar -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', async function () {

    var calendarEl = document.getElementById('calendar');

    // LOAD EVENTS FROM API
    async function loadEvents() {
        const res = await fetch('/api/events?calendarId=@Model.Id');
        return await res.json();
    }

    // FULLCALENDAR INIT
    var calendar = new FullCalendar.Calendar(calendarEl, {
        headerToolbar: false,
        initialView: "dayGridMonth",

        events: async (info, success) => {
            const evs = await loadEvents();
            success(evs);
        },

        dateClick: function(info) {
            window.location.href = '/event/create/@Model.Id?start=' + info.dateStr;
        },

        eventClick: function(info) {
            window.location.href = '/event/edit/' + info.event.id;
        }
    });

    calendar.render();

    // BUTTON ACTIONS
    document.getElementById("cal-month").onclick = () => calendar.changeView("dayGridMonth");
    document.getElementById("cal-week").onclick = () => calendar.changeView("timeGridWeek");
    document.getElementById("cal-day").onclick = () => calendar.changeView("timeGridDay");
    document.getElementById("cal-today").onclick = () => calendar.today();

});
</script>
