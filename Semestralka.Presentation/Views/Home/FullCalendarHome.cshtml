@model Semestralka.Domain.Entities.Calendar
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

@{
    ViewData["Title"] = "Kalend√°≈ô";

    if (Model == null)
    {
        <p>Kalend√°≈ô nen√≠ dostupn√Ω.</p>
        return;
    }

    var currentUserId = HttpContextAccessor.HttpContext?.Session.GetString("userid");
    bool isOwner = currentUserId != null && Model.OwnerId.ToString() == currentUserId;

    string calendarTitle = isOwner
        ? "M≈Øj kalend√°≈ô"
        : $"Sd√≠len√Ω kalend√°≈ô ‚Äì {Model.Owner?.FullName}";

    string permission = "read";
    if (!isOwner && currentUserId != null)
    {
        var shared = Model.SharedWith?.FirstOrDefault(s => s.UserId.ToString() == currentUserId);
        if (shared != null)
            permission = shared.Permission;
    }

    bool canEdit = isOwner || permission == "edit";
}

<!-- üî¥ FULLCALENDAR CSS ‚Äì MUS√ç B√ùT -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/main.min.css" rel="stylesheet" />

<div class="calendar-topbar d-flex align-items-center justify-content-between mb-3">

    <div class="d-flex align-items-center gap-3">
        <button id="cal-prev" class="cal-nav">&lsaquo;</button>
    </div>

    <div class="calendar-title" id="cal-title">‚Äì</div>

    <div class="d-flex align-items-center gap-3">
        <button id="cal-next" class="cal-nav">&rsaquo;</button>

        <button id="cal-day" class="btn btn-outline-purple">Den</button>
        <button id="cal-week" class="btn btn-outline-purple">T√Ωden</button>
        <button id="cal-month" class="btn btn-purple">Mƒõs√≠c</button>

        @if (isOwner)
        {
            <a class="btn btn-outline-purple" href="/calendar/share/@Model.Id">
                ü§ù Sd√≠let
            </a>
        }
    </div>
</div>

<div id="calendar" class="mb-4"></div>

<!-- FULLCALENDAR JS -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js"></script>

<!-- üî• GLOB√ÅLN√ç PROMƒöNN√â PRO calendar.js -->
<script>
    window.CALENDAR_ID = "@Model.Id";
    window.CAN_EDIT = @canEdit.ToString().ToLower();
</script>

<script src="/js/calendar.js"></script>
